<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TAGS ‚Äì Travel Tag Translator</title>
<style>
  :root {
    --bg-color: #f5f5f5;
    --text-color: #222;
    --card-bg: #fff;
    --accent: #0077ff;
  }
  body.dark {
    --bg-color: #121212;
    --text-color: #f0f0f0;
    --card-bg: #1e1e1e;
    --accent: #4da6ff;
  }
  body {
    font-family: Arial, sans-serif;
    background: var(--bg-color);
    color: var(--text-color);
    margin: 0;
    padding: 20px;
    transition: background 0.3s, color 0.3s;
  }
  .container {
    max-width: 650px;
    margin: auto;
    background: var(--card-bg);
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.15);
  }
  h1,h3 { text-align:center; }
  input,button,select {
    width: 100%; padding: 12px; margin: 8px 0;
    border-radius: 8px; border: 1px solid #ccc;
    font-size: 1em;
    background: var(--card-bg);
    color: var(--text-color);
  }
  button {
    cursor: pointer;
    background: var(--accent);
    color: #fff;
    font-weight: bold;
    border: none;
    transition: opacity 0.3s;
  }
  button:hover:enabled { opacity: 0.9; }
  button:disabled { background:#777; cursor:not-allowed; }
  .result,.history-item {
    background: #eee;
    padding: 10px; margin: 5px 0;
    border-radius: 8px;
  }
  body.dark .result, body.dark .history-item {
    background: #2a2a2a;
  }
  .instructions {
    background: #fafafa;
    padding: 12px;
    border-radius: 8px;
    margin-bottom: 12px;
    font-size: 0.95em;
  }
  body.dark .instructions {
    background: #1a1a1a;
  }
  .history-container {
    max-height: 200px;
    overflow-y: auto;
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 5px;
    background: var(--card-bg);
  }
  .history-actions { text-align:right; margin-bottom:5px; }
  .clear-btn { background:#e74c3c; color:white; border:none; }
  .settings-panel {
    display: none;
    padding: 12px;
    margin-bottom: 15px;
    border-radius: 8px;
    border: 1px solid #ccc;
    background: var(--card-bg);
  }
  .settings-panel.active { display: block; }
  #ocrStatus {
    font-size: 0.9em;
    color: var(--accent);
    text-align: center;
  }
</style>
</head>
<body>

<div class="container">
  <h1>üè∑Ô∏è TAGS ‚Äì Foreign Tag Translator</h1>

  <!-- Settings Menu -->
  <button id="settingsToggle">‚öôÔ∏è Settings</button>
  <div id="settingsPanel" class="settings-panel">
    <label for="homeCountry">Home Country:</label>
    <select id="homeCountry">
      <option value="USD">United States (USD)</option>
      <option value="EUR">Europe (EUR)</option>
      <option value="GBP">United Kingdom (GBP)</option>
      <option value="JPY">Japan (JPY)</option>
      <option value="CNY">China (CNY)</option>
      <option value="MXN">Mexico (MXN)</option>
    </select>

    <label for="themeSelect">Theme:</label>
    <select id="themeSelect">
      <option value="light">Light</option>
      <option value="dark">Dark</option>
    </select>
  </div>

  <!-- Instructions -->
  <div class="instructions">
    <strong>How to Use:</strong><br>
    1. Type/paste a tag (e.g. <code>Zara EUR 38</code>) <br>
    or <strong>upload/take a picture</strong> of the tag.<br>
    2. Optionally, enter the price in local currency<br>
    3. Click <strong>Translate Tag</strong>
  </div>

  <!-- Tag Scan Input -->
  <input type="text" id="tagScan" placeholder="Example: Zara EUR 38">
  <input type="file" id="tagImage" accept="image/*" capture="environment">
  <div id="ocrStatus"></div>
  <input type="number" id="tagPrice" placeholder="Price in local currency (optional)">
  <button id="translateBtn" disabled>Translate Tag</button>

  <!-- Result -->
  <div id="result" class="result" style="display:none;"></div>

  <!-- History -->
  <h3>History</h3>
  <div class="history-actions">
    <button class="clear-btn" id="clearHistoryBtn">Clear History</button>
  </div>
  <div id="history" class="history-container"></div>
</div>

<!-- Tesseract.js OCR -->
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

<script>
  // === Brand size charts (simplified for demo) ===
  const brandSizeChart = {
    Zara: { EUR: { "34":"XS","36":"S","38":"M","40":"L","42":"XL" },
            GBP: { "6":"XS","8":"S","10":"M","12":"L" },
            USD: { "2":"XS","4":"S","6":"M","8":"L" } },
    Nike: { EUR: { "36":"S","38":"M","40":"L" },
            GBP: { "8":"S","10":"M","12":"L" },
            USD: { "S":"S","M":"M","L":"L","XL":"XL" } },
    "H&M": { EUR: { "34":"XS","36":"S","38":"M","40":"L" },
             GBP: { "6":"XS","8":"S","10":"M","12":"L" },
             USD: { "2":"XS","4":"S","6":"M","8":"L" } },
    Uniqlo: { JPY: { "S":"S","M":"M","L":"L","XL":"XL" },
              EUR: { "S":"S","M":"M","L":"L","XL":"XL" } }
  };

  // Exchange rates (demo static values)
  const exchangeRates = { USD:1, EUR:1.05, GBP:0.85, JPY:150, CNY:7.2, MXN:17 };

  // Load saved settings
  let history = JSON.parse(localStorage.getItem("tagHistory") || "[]");
  let homeCountry = localStorage.getItem("homeCountry") || "USD";
  let theme = localStorage.getItem("theme") || "light";
  applyTheme(theme);
  document.getElementById("homeCountry").value = homeCountry;
  document.getElementById("themeSelect").value = theme;

  // === Smarter Parser ===
  function parseTag(input) {
    if (!input) return null;
    const text = input.toUpperCase();

    // 1. Detect brand
    const brands = Object.keys(brandSizeChart);
    const brand = brands.find(b => text.includes(b.toUpperCase()));
    if (!brand) return null;

    // 2. Detect country code (or fallback)
    const countries = Object.keys(exchangeRates);
    const country = countries.find(c => text.includes(c)) || homeCountry;

    // 3. Detect size
    const sizePatterns = /(XXL|XL|XS|S|M|L|\b\d{1,3}\b)/g;
    const matches = text.match(sizePatterns);
    if (!matches) return null;
    const tagSize = matches[0];

    return { brand, country, tagSize };
  }

  // === Render History ===
  function renderHistory() {
    const histDiv = document.getElementById('history');
    histDiv.innerHTML = '';
    if (history.length === 0) {
      histDiv.innerHTML = "<em>No history yet.</em>";
      return;
    }
    history.forEach(h => {
      const div = document.createElement('div');
      div.className = 'history-item';
      div.innerHTML = `${h.brand} ${h.country} ${h.tagSize} ‚Üí US ${h.usSize} ‚Ä¢ ${h.convertedPrice === "N/A" ? "N/A" : "$"+h.convertedPrice}`;
      histDiv.appendChild(div);
    });
  }

  // === Apply Theme ===
  function applyTheme(mode) {
    document.body.classList.toggle("dark", mode === "dark");
  }

  // === Event Listeners ===
  document.getElementById('tagScan').addEventListener('input', () => {
    document.getElementById('translateBtn').disabled = !document.getElementById('tagScan').value.trim();
  });

  document.getElementById('translateBtn').addEventListener('click', () => {
    const parsed = parseTag(document.getElementById('tagScan').value);
    if (!parsed) { alert("Couldn't read tag. Try again."); return; }
    const { brand, country, tagSize } = parsed;
    const price = parseFloat(document.getElementById('tagPrice').value) || 0;
    if (!brandSizeChart[brand] || !brandSizeChart[brand][country]) {
      alert("Unknown brand or country."); return;
    }
    const usSize = brandSizeChart[brand][country][tagSize] || "?";
    let convertedPrice = "N/A";
    if (price && exchangeRates[country]) {
      const usdRate = exchangeRates[homeCountry] || 1;
      convertedPrice = (price * (usdRate / exchangeRates[country])).toFixed(2);
    }
    const resultDiv = document.getElementById('result');
    resultDiv.style.display = 'block';
    resultDiv.innerHTML = `
      Brand: ${brand} <br>
      Tag Country: ${country} <br>
      Tag Size: ${tagSize} <br>
      US Size: ${usSize} <br>
      Price in ${homeCountry}: ${convertedPrice === "N/A" ? "N/A" : "$"+convertedPrice}
    `;
    history.unshift({ brand, country, tagSize, usSize, convertedPrice });
    localStorage.setItem("tagHistory", JSON.stringify(history));
    renderHistory();
  });

  document.getElementById("clearHistoryBtn").addEventListener("click", () => {
    if (confirm("Clear all history?")) {
      history = [];
      localStorage.removeItem("tagHistory");
      renderHistory();
    }
  });

  document.getElementById("settingsToggle").addEventListener("click", () => {
    document.getElementById("settingsPanel").classList.toggle("active");
  });

  document.getElementById("homeCountry").addEventListener("change", (e) => {
    homeCountry = e.target.value;
    localStorage.setItem("homeCountry", homeCountry);
  });

  document.getElementById("themeSelect").addEventListener("change", (e) => {
    theme = e.target.value;
    localStorage.setItem("theme", theme);
    applyTheme(theme);
  });

  // === OCR Handling ===
  document.getElementById("tagImage").addEventListener("change", async (e) => {
    const file = e.target.files[0];
    if (!file) return;
    document.getElementById("ocrStatus").textContent = "üì∏ Reading tag...";
    const { createWorker } = Tesseract;
    const worker = await createWorker('eng');
    const { data: { text } } = await worker.recognize(file);
    await worker.terminate();
    document.getElementById("ocrStatus").textContent = "OCR Result: " + text.trim();
    document.getElementById("tagScan").value = text.trim().replace(/\s+/g, " ");
    document.getElementById("translateBtn").disabled = false;
  });

  // Init
  renderHistory();
</script>

<!-- Credit -->
<div style="text-align:center; margin-top:20px; font-size:0.85em; color:#555;">
  Chief Development Officer: Josh Cohen | Founder: Bodey Rietz v6
</div>

</body>
</html>
